<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta property="og:url" content="http://the-javascripting-english-major.org/v1/14-events-popups" />
    <meta property="og:type" content="website" />
    
      <meta property="og:title" content="Integrating Leaflet with Events | The JavaScripting English Major" />
      <title>Integrating Leaflet with Events | The JavaScripting English Major</title>
      <meta name="twitter:title" content="Integrating Leaflet with Events | The JavaScripting English Major" />
    
    <meta name="DC.title" content="The JavaScripting English Major" />
    <meta name="DC.creator" content="Sá Pereira, Moacir P." />
    <meta name="DC.description" content="A 15-session course that teaches humanities undergraduates how to write their own web-based project using JavaScript." />
    <meta name="DC.type" content="Text">
    <meta name="DC.created" content="2017-07-25">
    <meta name="DC.date" content="2017-07-25">
    <meta property="og:site_name" content="The JavaScripting English Major" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="A 15-session course that teaches humanities undergraduates how to write their own web-based project using JavaScript." />
    <meta property="description" content="A 15-session course that teaches humanities undergraduates how to write their own web-based project using JavaScript." />
    <meta property="og:image" content="http://i.imgur.com/7FNZU7I.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:height" content="285" />
    <meta property="og:image:width" content="535" />
    <meta property="og:url" content="https://the-javascripting-english-major.org/v1/14-events-popups" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@JSingEnglishMaj" />
    <meta name="twitter:creator" content="@muziejus" />
    <meta name="twitter:description" content="A 15-session course that teaches humanities undergraduates how to write their own web-based project using JavaScript." />
    <meta name="twitter:image" content="http://i.imgur.com/Sh7MOqg.jpg" />
    <link rel="canonical" href="https://the-javascripting-english-major.org/v1/14-events-popups" />
    <link rel="apple-touch-icon" sizes="180x180" href="/v1/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/v1/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/v1/favicon-16x16.png">
    <link rel="manifest" href="/v1/manifest.json">
    <link rel="mask-icon" href="/v1/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    <script type="application/ld+json">
    {"name":null,"description":"A 15-session course that teaches humanities undergraduates how to write their own web-based project using JavaScript.","author":null,"@type":"WebPage","url":"https://the-javascripting-english-major.org/v1/14-events-popups","image":null,"publisher":null,"headline":"The JavaScripting English Major","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/v1/assets/css/style.css?v=4d7e5e7dced98209cd960e9bf09167782dc05716">
  </head>

  <body>
    <nav id="topNav" class="navbar navbar-toggleable-md fixed-top navbar-light bg-base2">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="/v1/contents">
    <img class="brand-img" alt=".js" src="/v1/assets/images/logo-no-border-sq.svg" width="35">
    <span id="brand-name-small">The .JSing English Major</span>
    <span id="brand-name-big">The JavaScripting English Major</span>
  </a>
  <div class="collapse navbar-collapse" id="navbar">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="chapters" aria-expanded="false" aria-haspopup="true" data-toggle="dropdown" href="#">
          Chapters
        </a>
        <div class="dropdown-menu" aria-labelledby="chapters">
          <a class="dropdown-item" href="/v1/0-introduction">0. Introduction</a>
          <a class="dropdown-item" href="/v1/1-environment">1. Environment</a>
          <a class="dropdown-item" href="/v1/2-calculator">2. JS Calculator</a>
          <a class="dropdown-item" href="/v1/3-programming">3. Programming</a>
          <a class="dropdown-item" href="/v1/4-functions">4. Functions</a>
          <a class="dropdown-item" href="/v1/5-collections">5. Collections</a>
          <a class="dropdown-item" href="/v1/6-abstraction">6. Abstraction</a>
          <a class="dropdown-item" href="/v1/7-errors">7. Oops!</a>
          <a class="dropdown-item" href="/v1/8-webpage">8. Webpage Writing</a>
          <a class="dropdown-item" href="/v1/9-dataset">9. Datasets</a>
          <a class="dropdown-item" href="/v1/10-leaflet">10. Leaflet</a>
          <a class="dropdown-item" href="/v1/11-geojson">11. Starting a Project</a>
          <a class="dropdown-item" href="/v1/12-markdown">12. Markdown</a>
          <a class="dropdown-item" href="/v1/13-bootstrap">13. Layout and Content</a>
          <a class="dropdown-item" href="/v1/14-events-popups">14. Events and Popups</a>
          <a class="dropdown-item" href="/v1/15-go-live">15. Going Live</a>
          <a class="dropdown-item" href="/v1/a-resources">A. Resources</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="help" aria-expanded="false" aria-haspopup="true" data-toggle="dropdown" href="#">
          Help
        </a>
        <div class="dropdown-menu" aria-labelledby="help">
          <a class="dropdown-item" href="/v1/help/map-to-version-2">Map to version 2</a>
          <a class="dropdown-item" href="/v1/help/js-cheat-sheet">JavaScript Cheat Sheet</a>
          <a class="dropdown-item" href="/v1/help/atom">Atom Help</a>
        </div>
      </li>
      <li class="nav-item">
        <a href="/v1/about" class="nav-link">About</a>
      </li>
    </ul>
  </div>
</nav>


    <div class="container">
      <div class="row">
        <aside class="col-md-4">
          <h1>Integrating Leaflet with Events</h1>
          <hr>
          <center>
            <h2 class="fa fa-spinner"></h2>
          </center>
        </aside>
        <article class="col-md-8">
          <p>The “Could Be” Project is coming along nicely, as is, I hope, your own
project. In between chapters, I added some code so that the poem would load
inside <code class="highlighter-rouge">#poem</code> using the same technique for the tabs. We’ll be working with
that a bit in this chapter, as this chapter is devoted to integrating Leaflet
with the rest of the page. In my own wireframing for the “Could Be” Project
that I mentioned in the <a href="/v1/13-bootstrap">previous chapter</a>, I wanted it to be
the case that when the user clicks on a place in the poem, that has the map zoom to
that place and also reveals the tab holding the information for that place.</p>

<p>There are a few ways to do this, but I will choose one that is a bit more
involved, so that you can see other applications of jQuery.</p>

<section id="adding-links">
  <h2 id="s-adding-links-to-the-poem">Adding links to the poem</h2>

  <p>We have the text of the poem appearing inside <code class="highlighter-rouge">#poem</code>, but it’s “plain”
text–it has no markup or <code class="highlighter-rouge">&lt;a&gt;</code> tags. How can we tell jQuery to wrap the place
names in tags? Start with just one example, “Hastings Street”:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s2">"http://the-javascripting-english-major.org/v1/examples/markdown/poem.md"</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">poem</span><span class="p">){</span>
    <span class="kd">let</span> <span class="nx">html</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="nx">md</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">poem</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#poem"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
    <span class="c1">// The above is the same as the $.ajax() call in the prev. ch.</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#poem"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">oldHtml</span><span class="p">){</span>
      <span class="kd">let</span> <span class="nx">newHtml</span><span class="p">;</span>
      <span class="nx">newHtml</span> <span class="o">=</span> <span class="nx">oldHtml</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/Hastings Street/g</span><span class="p">,</span> <span class="s2">"&lt;a href='#' data-place='hastings-street'&gt;Hastings Street&lt;/a&gt;"</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">newHtml</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>  </div>

  <p>Those added five lines are doing quite a bit, so I’ll walk through them
step-by-step:</p>

  <ol>
    <li><code class="highlighter-rouge">$("#poem")</code>: Select <code class="highlighter-rouge">#poem</code>.</li>
    <li><code class="highlighter-rouge">.html(</code>: Use the <code class="highlighter-rouge">.html()</code> method on the selected content. Recall that
<code class="highlighter-rouge">.html()</code> by itself <em>gets</em> the HTML. <code class="highlighter-rouge">.html("string")</code> <em>sets</em> the HTML. Now
we see that <code class="highlighter-rouge">.html(function())</code> <em>manipulates</em> the HTML.</li>
    <li><code class="highlighter-rouge">.function(_, oldHtml){</code>: The anonymous function inside the <code class="highlighter-rouge">.html()</code>
method inherits two variables, an index value I am calling <code class="highlighter-rouge">_</code>, and the
“old” HTML, which I am calling <code class="highlighter-rouge">oldHtml</code>. I won’t use <code class="highlighter-rouge">_</code>. I’m only
interested in <code class="highlighter-rouge">oldHtml</code>.</li>
    <li>Define a <code class="highlighter-rouge">newHtml</code> variable and assign it to the result of:</li>
    <li><code class="highlighter-rouge">oldHtml.replace(</code>: Strings have a <code class="highlighter-rouge">.replace()</code> method, that lets us
replace part of the string with a new string.</li>
    <li><code class="highlighter-rouge">/Hastings Street/g,</code>: A <strong>regular expression</strong> (more below) that basically
means “every instance of ‘Hastings Street.’”</li>
    <li><code class="highlighter-rouge">"&lt;a href='#' data-tab='hastings-street'&gt;Hastings Street&lt;/a&gt;"</code>: The
replacement string. Notice the addition of a <code class="highlighter-rouge">data-tab</code> attribute I’ll be
using later.</li>
    <li><code class="highlighter-rouge">return</code>: Return the result of <code class="highlighter-rouge">newHtml</code>.</li>
  </ol>

  <p>Everything here should familiar to you, except for that regular expression.
Regular expressions are ways of matching string patterns that are common in
programming languages. The syntax is complex, but, as a result, “regexes” are
extremely powerful.<sup id="fnref:regex"><a href="#fn:regex" class="footnote">1</a></sup> For the sake of this course, you only need to know
that:</p>

  <ol>
    <li>Regular expressions are bounded by <code class="highlighter-rouge">/</code> on each side.</li>
    <li>A <code class="highlighter-rouge">g</code> at the end of a regex means to match <em>every</em> occurrence of the
pattern.</li>
    <li>To use a variable in a regex, you have to define and assign the regex, as
we’ll see below.</li>
  </ol>

  <p>The code as it is works perfectly for “Hastings Street,” but, of course, we
have five places. Let’s create an array that we can loop over, then:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">let</span> <span class="nx">placesArray</span><span class="p">;</span>
  <span class="nx">placesArray</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">text</span><span class="p">:</span> <span class="s2">"Hastings Street"</span><span class="p">,</span> <span class="na">tab</span><span class="p">:</span> <span class="s2">"hastings-street"</span><span class="p">,</span> <span class="na">html</span><span class="p">:</span> <span class="s2">"Hastings Street"</span><span class="p">},</span>
    <span class="p">{</span><span class="na">text</span><span class="p">:</span> <span class="s2">"18th &amp; Vine"</span><span class="p">,</span> <span class="na">tab</span><span class="p">:</span> <span class="s2">"eighteenth-and-vine"</span><span class="p">,</span> <span class="na">html</span><span class="p">:</span> <span class="s2">"18th &amp;amp; Vine"</span><span class="p">},</span>
</code></pre></div>  </div>

  <p><em>Wait a minute!</em> This looks familiar. Didn’t we do this already back in <a href="/v1/11-geojson/">Chapter
11</a>? Yes, we did. That means we can use that <code class="highlighter-rouge">couldBeFeatures</code>
   array of <code class="highlighter-rouge">Object</code>s again here. And now the point of the
   <code class="highlighter-rouge">.html</code> property I added back then becomes clear; to create an “&amp;“ in HTML, you have to type
   <code class="highlighter-rouge">&amp;amp;</code>.</p>

  <p>The loop:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s2">"http://the-javascripting-english-major.org/v1/examples/markdown/poem.md"</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">poem</span><span class="p">){</span>
    <span class="c1">// Read in the poem.</span>
    <span class="kd">let</span> <span class="nx">html</span><span class="p">;</span>
    <span class="c1">// Use the Markdown-it renderer I defined last chapter.</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="nx">md</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">poem</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#poem"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
    <span class="c1">// Once the poem is in, start the loop.</span>
    <span class="nx">couldBeFeatures</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">"#poem"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">oldHtml</span><span class="p">){</span>
        <span class="kd">let</span> <span class="nx">regex</span><span class="p">,</span> <span class="nx">newHtml</span><span class="p">;</span>
        <span class="c1">// Assign the the regex the value of feature.html and the </span>
        <span class="c1">// flag “g”. This is the equivalent to /Hastings Street/g.</span>
        <span class="nx">regex</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">html</span><span class="p">,</span> <span class="s2">"g"</span><span class="p">);</span>
        <span class="c1">// Fill in newHtml with the properties from the couldBeFeatures.</span>
        <span class="nx">newHtml</span> <span class="o">=</span> <span class="s2">"&lt;a href='#' data-tab='"</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">tab</span> <span class="o">+</span> <span class="s2">"'&gt;"</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">html</span> <span class="o">+</span> <span class="s2">"&lt;/a&gt;"</span><span class="p">;</span>
        <span class="c1">// Return the newHtml wherever `replace()` finds the value</span>
        <span class="c1">// of regex.</span>
        <span class="k">return</span> <span class="nx">oldHtml</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regex</span><span class="p">,</span> <span class="nx">newHtml</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>  </div>

  <p>Hopefully, this helps you see how looping over an array objects provides yet
even more functionality.</p>

  <p>Again, this is a slightly contrived example, and it depends on the fact that
the place names are all unique in that the regular expressions <strong>only</strong> match
the place names. If we had a place called “Could,” we’d be out of luck,
because there would be no easy way to tell if “Could” referred to a place or
was a regular word starting a line. Nevertheless, now you know how to
manipulate HTML, in addition to getting and setting it. With the links on the
page, though, we should make them do something.</p>

</section>
<section id="responding-to-clicks">
  <h2 id="s-making-the-links-respond-to-clicks">Making the links respond to clicks</h2>

  <p>You already know about jQuery’s <code class="highlighter-rouge">$("").click()</code> method, so building the basics
of making the links in the poem respond to clicks should be straightforward:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="s2">"#poem a"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="c1">// Do something when you click.</span>
<span class="p">});</span>
</code></pre></div>  </div>

  <p>The jQuery selector <code class="highlighter-rouge">"#poem a"</code> means “every instance of an <code class="highlighter-rouge">&lt;a&gt;</code> tag inside
<code class="highlighter-rouge">#poem</code>. Any other <code class="highlighter-rouge">&lt;a&gt;</code> tags on the web page remain
unaffected. As for doing something, there are two new methods to introduce
here, one from Bootstrap, and one from Leaflet.</p>

  <h3 id="s-using-bootstrap-to-reveal-a-tab">Using Bootstrap to reveal a tab</h3>

  <p>In Bootstrap, the <code class="highlighter-rouge">.tab("show")</code> method can show a tab. Getting the proper
selector in jQuery is a bit trickier, but this works for the “Hastings Street”
tab:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="s2">"#nav-tabs a[href='#hastings-street']"</span><span class="p">).</span><span class="nx">tab</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
</code></pre></div>  </div>

  <p>The selector is telling jQuery to select the <code class="highlighter-rouge">&lt;a&gt;</code> tag within the entity with
the id <code class="highlighter-rouge">nav-tabs</code> that has the <code class="highlighter-rouge">href</code> property of <code class="highlighter-rouge">#hastings-street</code>. So that
works for Hastings Street, but what about for all the places? This is why I
added the <code class="highlighter-rouge">data-tab</code> data attribute above. We can replace the code with:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="s2">"#nav-tabs a[href='#"</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">"tab"</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"']"</span><span class="p">).</span><span class="nx">tab</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
</code></pre></div>  </div>

  <p>Now whenever the user clicks on a link in the poem, the corresponding tab
opens under the map.</p>

  <h3 id="s-changing-map-state-with-a-click">Changing map state with a click</h3>

  <p>This one is a bit trickier, and to get it to work, we need to add two more
data attributes for each <code class="highlighter-rouge">&lt;a&gt;</code> tag in <code class="highlighter-rouge">#poem</code>, a <code class="highlighter-rouge">data-lat</code> and a <code class="highlighter-rouge">data-lng</code>.
Time to return to the loop above:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s2">"http://the-javascripting-english-major.org/v1/examples/markdown/poem.md"</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">poem</span><span class="p">){</span>
    <span class="c1">// Read in the poem.</span>
    <span class="kd">let</span> <span class="nx">html</span><span class="p">;</span>
    <span class="c1">// Use the Markdown-it renderer I defined last chapter.</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="nx">md</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">poem</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#poem"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
    <span class="c1">// Once the poem is in, start the loop.</span>
    <span class="nx">couldBeFeatures</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">"#poem"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">oldHtml</span><span class="p">){</span>
        <span class="c1">// Define two new variables, lat and lng.</span>
        <span class="kd">let</span> <span class="nx">regex</span><span class="p">,</span> <span class="nx">newHtml</span><span class="p">;</span>
        <span class="c1">// Assign the the regex the value of feature.html and the </span>
        <span class="c1">// flag “g”. This is the equivalent to /Hastings Street/g.</span>
        <span class="nx">regex</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">html</span><span class="p">,</span> <span class="s2">"g"</span><span class="p">);</span>
        <span class="c1">// Fill in newHtml with the properties from the couldBeFeatures.</span>
        <span class="nx">newHtml</span> <span class="o">=</span> <span class="s2">"&lt;a href='#' data-tab='"</span> <span class="o">+</span> 
          <span class="nx">feature</span><span class="p">.</span><span class="nx">tab</span> <span class="o">+</span> 
          <span class="s2">"' data-lat='"</span> <span class="o">+</span>
          <span class="nx">feature</span><span class="p">.</span><span class="nx">latLng</span><span class="p">.</span><span class="nx">lat</span> <span class="o">+</span>
          <span class="s2">"' data-lng='"</span> <span class="o">+</span>
          <span class="nx">feature</span><span class="p">.</span><span class="nx">latLng</span><span class="p">.</span><span class="nx">lng</span> <span class="o">+</span>
          <span class="s2">"'&gt;"</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">html</span> <span class="o">+</span> <span class="s2">"&lt;/a&gt;"</span><span class="p">;</span>
        <span class="c1">// Return the newHtml wherever `replace()` finds the value</span>
        <span class="c1">// of regex.</span>
        <span class="k">return</span> <span class="nx">oldHtml</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regex</span><span class="p">,</span> <span class="nx">newHtml</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>  </div>

  <p>Now there are three data attributes, and we can harvest the latitude and
longitude for our <code class="highlighter-rouge">$().click()</code> callback:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="s2">"#poem a"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">let</span> <span class="nx">tab</span><span class="p">,</span> <span class="nx">lat</span><span class="p">,</span> <span class="nx">lng</span><span class="p">;</span>
  <span class="nx">tab</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">"tab"</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#nav-tabs a[href='#"</span> <span class="o">+</span> <span class="nx">tab</span> <span class="o">+</span> <span class="s2">"']"</span><span class="p">).</span><span class="nx">tab</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
  <span class="nx">lat</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">"lat"</span><span class="p">);</span>
  <span class="nx">lng</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">"lng"</span><span class="p">);</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">panTo</span><span class="p">([</span><span class="nx">lat</span><span class="p">,</span> <span class="nx">lng</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>  </div>

  <p>That is certainly a mouthful, and despite how confusing this is, this is
probably the easiest way to do this. The first draft of this chapter had a far
more complex process, because I had not thought to create the
<code class="highlighter-rouge">couldBeFeatures</code> array. Then the second draft was still confusing because I
did not think to use <code class="highlighter-rouge">data-lat</code> and <code class="highlighter-rouge">data-lng</code> to get coordinates in the
links. But programming is like that. There are many ways to get to the
destination, and sometimes it takes time to figure out which is the most
elegant.</p>

</section>
<section id="popups">
  <h2 id="s-involved-leaflet-popups">Involved Leaflet popups</h2>

  <p>Back when I <a href="/v1/10-leaflet">introduced Leaflet</a>, you created a simple popup for
a marker. Because the popups are <code class="highlighter-rouge">&lt;div&gt;</code>s in their own right, it is possible
to put a lot of HTML inside of them. Here, we’ll make use of the other
properties in the GeoJSON file to create a popup that displays the lines in
which the place is mentioned and provides a link to the appropriate Wikipedia
article. To do so, we create some HTML called <code class="highlighter-rouge">popupContent</code> and add that when
defining the Leaflet markers. Adding the name and the link to Wikipedia is easy:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This is from what I added to could-be.js back in Chapter 11</span>
<span class="nx">couldBeLayer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">featureGroup</span><span class="p">(</span><span class="nx">couldBeFeatures</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">){</span>
  <span class="kd">let</span> <span class="nx">popupContent</span><span class="p">;</span>
  <span class="nx">popupContent</span> <span class="o">=</span> <span class="s2">"&lt;h4&gt;"</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">"&lt;/h4&gt;"</span><span class="p">;</span>
  <span class="nx">popupContent</span> <span class="o">=</span> <span class="nx">popupContent</span> <span class="o">+</span> <span class="s2">"Read about "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">" on &lt;a href='"</span><span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">wikipedia</span> <span class="o">+</span> <span class="s2">"'&gt;Wikipedia&lt;/a&gt;."</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">marker</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">latLng</span><span class="p">).</span><span class="nx">bindPopup</span><span class="p">(</span><span class="nx">popupContent</span><span class="p">);</span>
  <span class="p">})</span>
<span class="p">);</span>
</code></pre></div>  </div>

  <p>The <code class="highlighter-rouge">.bindPopup()</code> method takes a string of HTML for the marker’s popup. The
lines are a bit more complex because sometimes a place is only mentioned on
one line, and sometimes it’s mentioned on more than one:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">couldBeLayer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">featureGroup</span><span class="p">(</span><span class="nx">couldBeFeatures</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">){</span>
  <span class="kd">let</span> <span class="nx">popupContent</span><span class="p">,</span> <span class="nx">lines</span><span class="p">;</span>
  <span class="nx">popupContent</span> <span class="o">=</span> <span class="s2">"&lt;h4&gt;"</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">"&lt;/h4&gt;"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">){</span>
    <span class="nx">lines</span> <span class="o">=</span> <span class="s2">"lines "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">lines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">" and "</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">lines</span> <span class="o">=</span> <span class="s2">"line "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="nx">popupContent</span> <span class="o">=</span> <span class="nx">popupContent</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">" is mentioned on "</span> <span class="o">+</span> <span class="nx">lines</span> <span class="o">+</span> <span class="s2">".&lt;br /&gt;"</span><span class="p">;</span>
  <span class="nx">popupContent</span> <span class="o">=</span> <span class="nx">popupContent</span> <span class="o">+</span> <span class="s2">"Read about "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">" on &lt;a href='"</span><span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">wikipedia</span> <span class="o">+</span> <span class="s2">"'&gt;Wikipedia&lt;/a&gt;."</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">marker</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">latLng</span><span class="p">).</span><span class="nx">bindPopup</span><span class="p">(</span><span class="nx">popupContent</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">);</span>
</code></pre></div>  </div>

  <p>Of course, if a place were mentioned three times, then we’d have something
like “mentioned on lines 1 and 3 and 5.” It’d be possible to use regular
expressions to turn that into “lines 1, 3, and 5,” but that can be extra
credit, or something. But you can see that a lot of information can be crammed
into a popup. It’d even be possible to use an <code class="highlighter-rouge">$.ajax()</code> call to load in a
Markdown document!</p>

  <p>While we’re working with popups, however, I’d like to sneak in one last
change. I’d rather have the markers be tiny circles, and I’d like the circle
to be larger if a place is mentioned more times. In addition to <code class="highlighter-rouge">L.marker</code>,
Leaflet also offers <code class="highlighter-rouge">L.circleMarker</code>, which can take an option for a <code class="highlighter-rouge">.radius</code>
property. And while we’re at it, let’s give the markers a fun color:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">couldBeLayer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">featureGroup</span><span class="p">(</span><span class="nx">couldBeFeatures</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">){</span>
  <span class="kd">let</span> <span class="nx">popupContent</span><span class="p">,</span> <span class="nx">lines</span><span class="p">;</span>
  <span class="nx">popupContent</span> <span class="o">=</span> <span class="s2">"&lt;h4&gt;"</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">"&lt;/h4&gt;"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">){</span>
    <span class="nx">lines</span> <span class="o">=</span> <span class="s2">"lines "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">lines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">" and "</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">lines</span> <span class="o">=</span> <span class="s2">"line "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="nx">popupContent</span> <span class="o">=</span> <span class="nx">popupContent</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">" is mentioned on "</span> <span class="o">+</span> <span class="nx">lines</span> <span class="o">+</span> <span class="s2">".&lt;br /&gt;"</span><span class="p">;</span>
  <span class="nx">popupContent</span> <span class="o">=</span> <span class="nx">popupContent</span> <span class="o">+</span> <span class="s2">"Read about "</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">" on &lt;a href='"</span><span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">wikipedia</span> <span class="o">+</span> <span class="s2">"'&gt;Wikipedia&lt;/a&gt;."</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">circleMarker</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">latLng</span><span class="p">,</span> <span class="p">{</span> 
    <span class="na">radius</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">mentions</span><span class="p">,</span> 
    <span class="na">color</span><span class="p">:</span> <span class="s2">"#d33682"</span><span class="p">,</span> 
    <span class="na">fillColor</span><span class="p">:</span> <span class="s2">"#d33682"</span> 
    <span class="p">}).</span><span class="nx">bindPopup</span><span class="p">(</span><span class="nx">popupContent</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">);</span>
</code></pre></div>  </div>

  <p>The <code class="highlighter-rouge">.radius</code> property is multiplied by the <code class="highlighter-rouge">.mentions</code> property as defined in
the GeoJSON document. This works, but is, incidentally, extremely bad design.
A circle with a radius of 20 (10 × 2 mentions) is not twice the size of
a circle of radius 10 (10 × 1 mention), because the areas of two circles
are proportional to their radii <em>squared</em>. As a result, we’re better off if we
multiply the radius by the <em>square root</em> of the mentions, if we want the
circle to be twice as large. Easy enough. Just change the line that assigns
the <code class="highlighter-rouge">.radius</code> property to:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">radius</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">mentions</span><span class="p">),</span> 
</code></pre></div>  </div>

</section>
<section id="how-did">
  <h2 id="s-how-did-you-do-that">How did you do that?</h2>

  <p>This chapter relied a lot on trial and error on my part to make sure
everything worked correctly, so here I’ll mention two valuable suggestions for
when you’re designing your own project.</p>

  <p>First, any variable you define globally (not inside a function, for our
purposes) in JavaScript is available in the JavaScript console. For example,
if you look at the <a href="/v1/examples/could-be14.html">“Could Be” Project for the end of Chapter
14</a>, and you open the console on that page, you can
   type:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">couldBeFeatures</span><span class="p">;</span>
<span class="c1">//--&gt; [Object, Object, Object, Object, Object]</span>
</code></pre></div>  </div>

  <p>This tells you that <code class="highlighter-rouge">couldBeFeatures</code> is an array of <code class="highlighter-rouge">Object</code>s. Similarly,
there’s probably a little disclosure triangle (▶) next to the array that you
can click on that shows the properties for each object. On the other hand:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">map</span><span class="p">;</span>
<span class="c1">//--&gt; e {options: Object, _container: &lt;div id="could-be-map"&gt;, _leaflet_id: 2, _containerId: 3, _fadeAnimated: true, …}</span>
</code></pre></div>  </div>

  <p>Again, the disclosure triangle will open up the <code class="highlighter-rouge">map</code> Leaflet <code class="highlighter-rouge">Object</code> so you
can see all of its properties. Sometimes it’s valuable to dig into those
objects to find places where you can hook into the <code class="highlighter-rouge">Object</code> to add
interactivity. Even non-global variables can be sent to the console using our
old friend <code class="highlighter-rouge">console.log(variable)</code>.</p>

  <p>Second, when it comes to styling, it’s possible to drill down the disclosure
triangles on the elements tab to see how, for example, popups are styled. If
you click on one of the markers, so that its popup shows, you can see on the
elements tab a tree of HTML like this:</p>

  <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"could-be-map"</span> <span class="err">…</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- Everything below is generated by Leaflet --&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-pane leaflet-map-pane"</span> <span class="err">…</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-pane leaflet-tile-pane"</span><span class="nt">&gt;</span>…<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-pane leaflet-shadow-pane"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-pane leaflet-overlay-pane"</span><span class="nt">&gt;</span>…<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-pane leaflet-marker-pane"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-pane leaflet-tooltip-pane"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-pane leaflet-popup-pane"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-popup leaflet-zoom-animated"</span><span class="err">…</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-popup-content-wrapper"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"leaflet-popup-content"</span><span class="nt">&gt;</span>
</code></pre></div>  </div>

  <p>The Leaflet panes are in descending order. The first pane (or layer) is the
tiles. Then the shadows (for markers), then the overlay pane (where our
<code class="highlighter-rouge">circleMarkers</code> are), then the marker pane, tooltip pane, and, finally, the
popup pane. When a marker is clicked on, Leaflet creates the <code class="highlighter-rouge">.leaflet-popup</code>
<code class="highlighter-rouge">&lt;div&gt;</code> and populates it with the popup’s contents. But as you can see, if you
were to style <code class="highlighter-rouge">.leaflet-popup-content</code> in your <code class="highlighter-rouge">.css</code> file, you could, say,
change the font of the popups, for example. Or give them a background color
other than white. The popups are just HTML, meaning they react the same styles
you define in your <code class="highlighter-rouge">.css</code> file as the rest of the page.</p>

  <p>As a result, the answer to “How did you do that?” is not only usually “drilled
down into the details,” but also “just like you can.” The details of the
“Could Be” Project are visible to anyone who wants to look at them.</p>
</section>

<section id="exercises">
  <h2 id="s-exercises">Exercises</h2>

  <ol>
    <li>Add interactivity between your page and your map in your project.</li>
    <li>Create rich popups for your map.</li>
  </ol>
</section>

<h2 id="s-footnotes">Footnotes</h2>

<div class="footnotes">
  <ol>
    <li id="fn:regex">
      <p>Both Haverbeke and Crockford devote entire chapters to regexes. You can use the <a href="https://regex101.com/">Regular Expressions 101</a> app to test your regexes if you want to learn more, but be sure to pick the JavaScript flavor from the menu on the left. <a href="#fnref:regex" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

          <div class="row justify-content-between">
            <div class="">
            
              <a class="btn btn-info" href="/v1/13-bootstrap">
                Previous Chapter
              </a>
            
            </div>
            <div class="">
            
              <a class="btn btn-info" href="/v1/15-go-live">
                Next Chapter
              </a>
            
            </div>
          </div>
        </article>
      </div>
    </div>
    <footer class="footer">
  <p>
    <small>© 2017, <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> by <a href="http://moacir.com" target="_blank">Moacir P. de Sá Pereira</a>.</small>
  </p>
</footer>

    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
<script src="/v1/assets/js/main.js"></script>


  </body>
